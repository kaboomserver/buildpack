#!/bin/sh
PATH="$HOME/autossh/bin/:$HOME/java/bin/:$HOME/tmux/bin/:$HOME/ttyd/bin/:$PATH"

echo "$REMOTE_KEY" > .ssh/remote
echo "$SYNC_KEY" > .ssh/id_rsa
chmod 600 .ssh/remote

ssh-keyscan github.com >> .ssh/known_hosts

chmod -R 500 plugins/bStats/ plugins/PluginMetrics/ plugins/ProtocolLib/

git clone git@github.com:kaboomserver/schematics.git plugins/FastAsyncWorldEdit/schematics/

tmux set -g status off

while true; do
	tmux new -d -s server 'sh -c script/server' >/dev/null
	tmux new -d -s remote 'sh -x script/remote' >/dev/null
	tmux new -d -s schematics 'sh -x script/schematics' >/dev/null
	sleep 5
done &

ttyd -p $PORT tmux new-session -t server &
sleep 30

while true; do
	tmux new -d -s alivecheck 'sh -x script/alivecheck' >/dev/null
	sleep 5
done &

sleep infinity
